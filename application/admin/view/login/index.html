{include file="admin@public/header" /}
<body class="layui-layout-body">
<div id="LAY_app">
    <div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" style="display: none;">
        <div class="layadmin-user-login-main">
            <div class="layadmin-user-login-box layadmin-user-login-header">
                <h2>xx | 管理后台</h2>
                <p>xx·xxxx平台</p>
            </div>
            <div class="layadmin-user-login-box layadmin-user-login-body layui-form">
                <div class="layui-form-item">
                    <label class="layadmin-user-login-icon layui-icon layui-icon-username" for="username"></label>
                    <input type="text" name="username" id="username" lay-verify="required" placeholder="用户名" class="layui-input" value="{$username|default=''}">
                </div>
                <div class="layui-form-item">
                    <label class="layadmin-user-login-icon layui-icon layui-icon-password" for="password"></label>
                    <input type="password" name="password" id="password" lay-verify="required" placeholder="密码" class="layui-input" value="">
                </div>
                <div class="layui-form-item">
                    <div class="layui-row">
                        <div class="layui-col-xs7">
                            <label class="layadmin-user-login-icon layui-icon layui-icon-vercode" for="captcha"></label>
                            <input type="text" name="captcha" id="captcha" lay-verify="required" placeholder="输入验证码" class="layui-input">
                        </div>
                        <div class="layui-col-xs5">
                            <div style="margin-left: 10px;">
                                <img src="{:url('admin/login/captcha')}" alt="captcha" class="layadmin-user-login-codeimg" id="verify_img" onclick="refreshVerify()">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item" style="margin-bottom: 20px;">
                    <input type="checkbox" name="remember" id="remember" lay-skin="primary" title="记住账号" checked="checked"><div class="layui-unselect layui-form-checkbox" lay-skin="primary"><span>记住密码</span><i class="layui-icon"></i></div>
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="login-submit" id="loginSubmit">登 录</button>
                </div>
            </div>
        </div>

        <div class="layui-trans layadmin-user-login-footer">

            <p>© 2019 <a href="#" target="_blank">xxxx</a></p>
            <p>
                <span><a href="#" target="_blank">联系我们</a></span>
                <span><a href="#" target="_blank">xx官网</a></span>
            </p>
        </div>


    </div>
</div>
<script>
    //从子页跳出
    if (window != top){
        top.location.href = location.href;
    }

    //验证码刷新
    function refreshVerify() {
        $('#verify_img').attr("src", "{:url('admin/login/captcha')}");
    }

    //enter提交登录
    $("body").keydown(function() {
        if (event.keyCode == "13") {
            $('#loginSubmit').click();
        }
    });

    //提交登录
    $('#loginSubmit').click(function(){
        var username = $.trim($('#username').val());
        if (!username) {
            layer.msg('请填写用户名', {icon: 2, time : 1500});
            return false;
        }
        var password = $.trim($('#password').val());
        if (!password) {
            layer.msg('请填写密码', {icon: 2, time : 1500});
            return false;
        }
        var captcha = $.trim($('#captcha').val());
        if (!captcha) {
            layer.msg('请填写验证码', {icon: 2, time : 1500});
            return false;
        }
        var remember = $('#remember').is(':checked');
        remember = remember === true ? 1 : 0;
        $.ajax({
            type:'POST',
            url:'{:url("admin/login/index")}',
            dataType:'json',
            data:{
                username: username,
                password: password,
                captcha: captcha,
                remember:remember
            },
            success:function(data){
                if(data.code == 0){
                    layer.msg(data.msg, {icon: 6,time:1000}, function(index){
                        layer.close(index);
                        window.location.href = data.url;
                    });
                } else{
                    refreshVerify();
                    $('#captcha').val('');
                    layer.msg(data.msg, {icon: 2, time : 1500});
                }
            },
            error:function(jqXHR){
                layer.msg('登录失败', {icon: 2, time : 1500});
            }
        });
    });
</script>
</body>
</html>

